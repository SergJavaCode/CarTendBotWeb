<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 600px;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }
        
        input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
        }
        
        .submit-btn:active {
            transform: translateY(0);
        }
        
        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .required::after {
            content: " *";
            color: #ff4757;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin-top: 15px;
            color: #667eea;
        }
        
        .error-message {
            color: #ff4757;
            text-align: center;
            margin-top: 15px;
            display: none;
            font-size: 14px;
            padding: 10px;
            background: #ffeaea;
            border-radius: 8px;
        }
        
        .success-message {
            color: #2ed573;
            text-align: center;
            margin-top: 15px;
            display: none;
        }
        
        .debug-info {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px;
            display: none;
        }
        
        .log-container {
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background: #f8f9fa;
            font-family: monospace;
            font-size: 12px;
            display: none;
        }
        
        .log-toggle {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 3px;
            border-bottom: 1px solid #eee;
        }
        
        .log-time {
            color: #6c757d;
            margin-right: 8px;
        }
        
        .log-info {
            color: #007bff;
        }
        
        .log-error {
            color: #dc3545;
        }
        
        .log-success {
            color: #28a745;
        }
        
        .log-warning {
            color: #ffc107;
        }
        
        .methods {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #ddd;
        }
        
        .methods h3 {
            margin-bottom: 10px;
            color: #333;
            font-size: 16px;
        }
        
        .method-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .method-btn:hover {
            background: #218838;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöó –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è</h1>
        
        <form id="carForm">
            <div class="form-group">
                <label for="year" class="required">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞</label>
                <input type="text" id="year" placeholder="2020" required>
            </div>
            
            <div class="form-group">
                <label for="vin" class="required">VIN –Ω–æ–º–µ—Ä</label>
                <input type="text" id="vin" placeholder="WF0XXX12345678901" required>
            </div>
            
            <div class="form-group">
                <label for="plate" class="required">–ì–æ—Å. –Ω–æ–º–µ—Ä</label>
                <input type="text" id="plate" placeholder="–ê123–ë–í777" required>
            </div>
            
            <div class="form-group">
                <label for="engine" class="required">–î–≤–∏–≥–∞—Ç–µ–ª—å</label>
                <input type="text" id="engine" placeholder="B58B30" required>
            </div>
            
            <div class="form-group">
                <label for="mileage" class="required">–ü—Ä–æ–±–µ–≥ (–∫–º)</label>
                <input type="number" id="mileage" placeholder="50000" required>
            </div>
            
            <div class="form-group">
                <label for="color" class="required">–¶–≤–µ—Ç</label>
                <input type="text" id="color" placeholder="–°–∏–Ω–∏–π –º–µ—Ç–∞–ª–ª–∏–∫" required>
            </div>
            
            <button type="button" class="submit-btn" id="submitBtn" onclick="sendData()">
                üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (Telegram)
            </button>
            
            <div class="methods">
                <h3>–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –æ—Ç–ø—Ä–∞–≤–∫–∏:</h3>
                <button type="button" class="method-btn" onclick="sendViaJSONP()">
                    üì® JSONP –º–µ—Ç–æ–¥
                </button>
                <button type="button" class="method-btn" onclick="sendViaForm()">
                    üìù –§–æ—Ä–º–∞ —Å target="_blank"
                </button>
                <button type="button" class="method-btn" onclick="sendViaImage()">
                    üñºÔ∏è Beacon —á–µ—Ä–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                </button>
                <button type="button" class="method-btn" onclick="copyToClipboard()">
                    üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ
                </button>
            </div>
            
            <div id="loading" class="loading">
                ‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
            </div>
            
            <div id="errorMessage" class="error-message">
                ‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
                <div id="errorDetails"></div>
            </div>
            
            <div id="successMessage" class="success-message">
                ‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!
            </div>
            
            <button type="button" class="log-toggle" onclick="toggleLog()">
                üìã –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ª–æ–≥
            </button>
            
            <div id="logContainer" class="log-container"></div>
            
            <div id="debugInfo" class="debug-info">
                –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏: –¥–∞–Ω–Ω—ã–µ –≤ –∫–æ–Ω—Å–æ–ª–∏
            </div>
        </form>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –ª–æ–≥–∞
        const appLog = [];
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = {
                timestamp,
                message,
                type
            };
            
            appLog.push(logEntry);
            updateLogDisplay();
            
            // –¢–∞–∫–∂–µ –≤—ã–≤–æ–¥–∏–º –≤ –∫–æ–Ω—Å–æ–ª—å
            const consoleMethod = type === 'error' ? 'error' : 
                                 type === 'warning' ? 'warn' : 'log';
            console[consoleMethod](`[${timestamp}] ${message}`);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ª–æ–≥–∞
        function updateLogDisplay() {
            const logContainer = document.getElementById('logContainer');
            logContainer.innerHTML = '';
            
            appLog.forEach(entry => {
                const logEntry = document.createElement('div');
                logEntry.className = `log-entry log-${entry.type}`;
                logEntry.innerHTML = `<span class="log-time">[${entry.timestamp}]</span> ${entry.message}`;
                logContainer.appendChild(logEntry);
            });
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ª–æ–≥–∞
        function toggleLog() {
            const logContainer = document.getElementById('logContainer');
            logContainer.style.display = logContainer.style.display === 'none' ? 'block' : 'none';
        }
        
        // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã
        function collectFormData() {
            const carData = {
                year: document.getElementById('year').value.trim(),
                vin: document.getElementById('vin').value.trim(),
                plate: document.getElementById('plate').value.trim(),
                engine: document.getElementById('engine').value.trim(),
                mileage: parseInt(document.getElementById('mileage').value) || 0,
                color: document.getElementById('color').value.trim()
            };
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!carData.year || !carData.vin || !carData.plate || !carData.engine || !carData.color) {
                const errorMsg = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!';
                addLog(errorMsg, 'error');
                alert(errorMsg);
                return null;
            }
            
            if (carData.vin.length !== 17) {
                const errorMsg = 'VIN –Ω–æ–º–µ—Ä –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 17 —Å–∏–º–≤–æ–ª–æ–≤!';
                addLog(errorMsg, 'error');
                alert(errorMsg);
                return null;
            }
            
            return carData;
        }
        
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Telegram WebApp
        function sendData() {
            addLog('–ò—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Ç–æ–¥ Telegram WebApp', 'info');
            
            const carData = collectFormData();
            if (!carData) return;
            
            if (window.Telegram && window.Telegram.WebApp) {
                // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Telegram WebApp
                Telegram.WebApp.sendData(JSON.stringify({
                    type: "car_data",
                    car: carData,
                    timestamp: new Date().toISOString()
                }));
                
                addLog('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ Telegram WebApp', 'success');
                showSuccess();
            } else {
                const errorMsg = 'Telegram WebApp –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω';
                addLog(errorMsg, 'error');
                alert(errorMsg);
            }
        }
        
        // –ú–µ—Ç–æ–¥ 1: JSONP (—Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
        function sendViaJSONP() {
            addLog('–ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ JSONP', 'info');
            
            const carData = collectFormData();
            if (!carData) return;
            
            const callbackName = 'jsonpCallback_' + Date.now();
            const script = document.createElement('script');
            
            // –°–æ–∑–¥–∞–µ–º callback —Ñ—É–Ω–∫—Ü–∏—é
            window[callbackName] = function(response) {
                addLog(`‚úÖ JSONP –æ—Ç–≤–µ—Ç: ${JSON.stringify(response)}`, 'success');
                delete window[callbackName];
                document.body.removeChild(script);
                showSuccess();
            };
            
            const url = `https://195.133.197.49/carinfo?callback=${callbackName}&data=${encodeURIComponent(JSON.stringify(carData))}`;
            script.src = url;
            
            // –¢–∞–π–º–∞—É—Ç –¥–ª—è –æ—à–∏–±–∫–∏
            setTimeout(() => {
                if (window[callbackName]) {
                    addLog('‚ùå –¢–∞–π–º–∞—É—Ç JSONP –∑–∞–ø—Ä–æ—Å–∞', 'error');
                    delete window[callbackName];
                    document.body.removeChild(script);
                }
            }, 10000);
            
            document.body.appendChild(script);
            addLog('JSONP –∑–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω', 'info');
        }
        
        // –ú–µ—Ç–æ–¥ 2: –§–æ—Ä–º–∞ —Å target="_blank"
        function sendViaForm() {
            addLog('–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ—Ä–º—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏', 'info');
            
            const carData = collectFormData();
            if (!carData) return;
            
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = 'https://195.133.197.49/carinfo';
            form.target = '_blank';
            form.style.display = 'none';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º—É
            Object.keys(carData).forEach(key => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = key;
                input.value = carData[key];
                form.appendChild(input);
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º timestamp
            const timestampInput = document.createElement('input');
            timestampInput.type = 'hidden';
            timestampInput.name = 'timestamp';
            timestampInput.value = new Date().toISOString();
            form.appendChild(timestampInput);
            
            document.body.appendChild(form);
            form.submit();
            document.body.removeChild(form);
            
            addLog('‚úÖ –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ', 'success');
            showSuccess();
        }
        
        // –ú–µ—Ç–æ–¥ 3: Beacon —á–µ—Ä–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (GET –∑–∞–ø—Ä–æ—Å)
        function sendViaImage() {
            addLog('–û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Beacon –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ', 'info');
            
            const carData = collectFormData();
            if (!carData) return;
            
            const params = new URLSearchParams();
            Object.keys(carData).forEach(key => {
                params.append(key, carData[key]);
            });
            params.append('timestamp', new Date().toISOString());
            params.append('method', 'beacon');
            
            const img = new Image();
            img.src = `https://195.133.197.49/carinfo?${params.toString()}`;
            img.style.display = 'none';
            
            img.onload = function() {
                addLog('‚úÖ Beacon –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
                showSuccess();
            };
            
            img.onerror = function() {
                addLog('‚ùå –û—à–∏–±–∫–∞ Beacon –∑–∞–ø—Ä–æ—Å–∞', 'error');
            };
            
            document.body.appendChild(img);
            addLog('Beacon –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ', 'info');
        }
        
        // –ú–µ—Ç–æ–¥ 4: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        function copyToClipboard() {
            const carData = collectFormData();
            if (!carData) return;
            
            const text = `–î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª—è:\n–ì–æ–¥: ${carData.year}\nVIN: ${carData.vin}\n–ù–æ–º–µ—Ä: ${carData.plate}\n–î–≤–∏–≥–∞—Ç–µ–ª—å: ${carData.engine}\n–ü—Ä–æ–±–µ–≥: ${carData.mileage} –∫–º\n–¶–≤–µ—Ç: ${carData.color}`;
            
            navigator.clipboard.writeText(text).then(() => {
                addLog('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
                alert('–î–∞–Ω–Ω—ã–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            }).catch(err => {
                addLog('‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + err, 'error');
            });
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—Ö
        function showSuccess() {
            const successMessage = document.getElementById('successMessage');
            successMessage.style.display = 'block';
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º WebApp —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã (—Ç–æ–ª—å–∫–æ –≤ Telegram)
            setTimeout(() => {
                if (window.Telegram && window.Telegram.WebApp) {
                    Telegram.WebApp.close();
                }
            }, 2000);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            const errorMessage = document.getElementById('errorMessage');
            const errorDetails = document.getElementById('errorDetails');
            
            errorDetails.textContent = message;
            errorMessage.style.display = 'block';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üöÄ WebApp –∑–∞–≥—Ä—É–∂–µ–Ω!', 'info');
            
            if (window.Telegram && window.Telegram.WebApp) {
                Telegram.WebApp.ready();
                Telegram.WebApp.expand();
                addLog('‚úÖ Telegram WebApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                
                // –°–∫—Ä—ã–≤–∞–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤ Telegram
                document.querySelector('.methods').style.display = 'none';
                
                addLog('üìä InitDataUnsafe –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã', 'info');
            } else {
                addLog('‚ö†Ô∏è Telegram WebApp –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã', 'warning');
                document.querySelector('.methods').style.display = 'block';
            }
            
            // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            if (new URLSearchParams(window.location.search).has('test')) {
                document.getElementById('year').value = '2022';
                document.getElementById('vin').value = 'WF0XXX12345678901';
                document.getElementById('plate').value = '–ê123–ë–í777';
                document.getElementById('engine').value = 'B58B30';
                document.getElementById('mileage').value = '50000';
                document.getElementById('color').value = '–°–∏–Ω–∏–π –º–µ—Ç–∞–ª–ª–∏–∫';
                addLog('üß™ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã', 'info');
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã –ø–æ Enter
            document.getElementById('carForm').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    sendData();
                }
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –ª–æ–≥–∞ –≤ —Ä–µ–∂–∏–º–µ –æ—Ç–ª–∞–¥–∫–∏
            document.querySelector('.log-toggle').style.display = 'block';
        });
    </script>
</body>
</html>
